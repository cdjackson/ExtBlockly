<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>ExtJS Blockly Demo</title>

    <link rel="stylesheet" type="text/css" href="ext-theme-classic-all.css"/>
    <script type="text/javascript" src="ext-all-debug.js"></script>

    <script type="text/javascript" src="Blockly.js"></script>

    <script type="text/javascript" src="../core/blockly.js"></script>
    <script type="text/javascript" src="../core/block.js"></script>
    <script type="text/javascript" src="../core/block_svg.js"></script>
    <script type="text/javascript" src="../core/blocks.js"></script>
    <script type="text/javascript" src="../core/icon.js"></script>
    <script type="text/javascript" src="../core/bubble.js"></script>
    <script type="text/javascript" src="../core/comment.js"></script>
    <script type="text/javascript" src="../core/connection.js"></script>
    <script type="text/javascript" src="../core/contextmenu.js"></script>
    <script type="text/javascript" src="../core/css.js"></script>
    <script type="text/javascript" src="../core/field.js"></script>
    <script type="text/javascript" src="../core/field_textinput.js"></script>
    <script type="text/javascript" src="../core/field_angle.js"></script>
    <script type="text/javascript" src="../core/field_checkbox.js"></script>
    <script type="text/javascript" src="../core/field_colour.js"></script>
    <script type="text/javascript" src="../core/field_dropdown.js"></script>
    <script type="text/javascript" src="../core/field_image.js"></script>
    <script type="text/javascript" src="../core/field_label.js"></script>
    <script type="text/javascript" src="../core/field_variable.js"></script>
    <script type="text/javascript" src="../core/flyout.js"></script>
    <script type="text/javascript" src="../core/generator.js"></script>
    <script type="text/javascript" src="../core/inject.js"></script>
    <script type="text/javascript" src="../core/input.js"></script>
    <script type="text/javascript" src="../core/msg.js"></script>
    <script type="text/javascript" src="../core/mutator.js"></script>
    <script type="text/javascript" src="../core/names.js"></script>
    <script type="text/javascript" src="../core/procedures.js"></script>
    <script type="text/javascript" src="../core/scrollbar.js"></script>
    <script type="text/javascript" src="../core/tooltip.js"></script>
    <script type="text/javascript" src="../core/trashcan.js"></script>
    <script type="text/javascript" src="../core/utils.js"></script>
    <script type="text/javascript" src="../core/variables.js"></script>
    <script type="text/javascript" src="../core/warning.js"></script>
    <script type="text/javascript" src="../core/widgetdiv.js"></script>
    <script type="text/javascript" src="../core/workspace.js"></script>
    <script type="text/javascript" src="../core/xml.js"></script>

    <script type="text/javascript" src="../blocks/colour.js"></script>
    <script type="text/javascript" src="../blocks/lists.js"></script>
    <script type="text/javascript" src="../blocks/logic.js"></script>
    <script type="text/javascript" src="../blocks/loops.js"></script>
    <script type="text/javascript" src="../blocks/math.js"></script>
    <script type="text/javascript" src="../blocks/procedures.js"></script>
    <script type="text/javascript" src="../blocks/text.js"></script>
    <script type="text/javascript" src="../blocks/variables.js"></script>

    <script type="text/javascript" src="../msg/js/en.js"></script>
</head>
<body>

<xml id="toolbox" style="display: none">
    <block type="controls_if"></block>
    <block type="controls_repeat_ext"></block>
    <block type="logic_compare"></block>
    <block type="math_number"></block>
    <block type="math_arithmetic"></block>
    <block type="text"></block>
    <block type="text_print"></block>
</xml>

<xml id="go">
    <block type="controls_if" id="26" inline="false" x="54" y="25">
        <value name="IF0">
            <block type="logic_compare" id="94" inline="true">
                <field name="OP">EQ</field>
                <value name="A">
                    <block type="variables_get" id="102">
                        <field name="VAR">item</field>
                    </block>
                </value>
                <value name="B">
                    <block type="variables_get" id="105">
                        <field name="VAR">item</field>
                    </block>
                </value>
            </block>
        </value>
        <statement name="DO0">
            <block type="controls_repeat_ext" id="17" inline="true">
                <value name="TIMES">
                    <block type="math_number" id="18">
                        <field name="NUM">10</field>
                    </block>
                </value>
                <statement name="DO">
                    <block type="variables_set" id="56" inline="true">
                        <field name="VAR">item</field>
                        <value name="VALUE">
                            <block type="math_arithmetic" id="75" inline="true">
                                <field name="OP">ADD</field>
                                <value name="A">
                                    <block type="variables_get" id="78">
                                        <field name="VAR">item</field>
                                    </block>
                                </value>
                                <value name="B">
                                    <block type="variables_get" id="86">
                                        <field name="VAR">item</field>
                                    </block>
                                </value>
                            </block>
                        </value>
                    </block>
                </statement>
            </block>
        </statement>
    </block>
</xml>

<script>
    var categoryArray = [
        {name: "Procedures", tooltip: "Hello there"},
        {name: "Math", icon: "sum.png", tooltip: "Hello there math"}
    ];
    var toolArray = [
        {category: "Procedures", block: "<xml><block type='procedures_defnoreturn'></block></xml>", name: "X"},
        {category: "Procedures", block: "<xml><block type='procedures_ifreturn'></block></xml>", name: "X"},
        {category: "Procedures", block: "<xml><block type='controls_if'></block></xml>", name: "X"},
        {category: "Math", block: "<xml><block type='controls_if'><mutation elseif='1'></mutation></block></xml>", name: "X"},
        {category: "Procedures", block: "<xml><block type='math_arithmetic'></block></xml>", name: "X"},
        {category: "Math", block: "<xml><block type='controls_repeat_ext'></block></xml>", name: "X"},
        {category: "Math", block: "<xml><block type='variables_set'></block></xml>", name: "X"}
    ];

    Ext.require([
        'Ext.window.Window',
        'Ext.tab.*',
        'Ext.toolbar.Spacer',
        'Ext.layout.container.Card',
        'Ext.layout.container.Border'
    ]);

    Ext.onReady(function () {
        Ext.QuickTips.init();

        var helpWindow = Ext.create('Ext.Window', {
            title: 'Blockly Output',
            width: 720,
            height: 300,
            closeAction: 'hide',
            html:"<div id='xmlOutput'></div>",
            listeners: {
                show: function(w) {
                    var x = blockly.getBlocks(true);
                    Ext.fly('xmlOutput').update(Ext.String.htmlEncode(x), false);
                }
            }
        });
        var toolbar = Ext.create('Ext.toolbar.Toolbar', {
            items: [
                {
                    icon: 'information-balloon.png',
                    itemId: 'show',
                    text: "Show XML",
                    cls: 'x-btn-icon',
                    disabled: false,
                    tooltip: "Save the workspace",
                    handler: function () {
                        helpWindow.show();
                    }
                }
            ]
        });

        var blockly = Ext.create('Ext.ux.blockly.Blockly', {
            tbar: toolbar,
            blockly: {
                toolbox: true,
                collapse: true,
                toolboxCategories: categoryArray,
                toolboxTools: toolArray,
                trashcan: true,
                blocks: "<xml>" + document.getElementById('go').innerHTML + "</xml>",
                path:"../"
            }
        });
        blockly.show();
        var viewPort = Ext.create('Ext.container.Viewport', {
            renderTo: document.body,
            layout: 'fit',
            items: [blockly]
        });
    });
</script>
</body>
</html>
